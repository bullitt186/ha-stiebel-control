#
#  Minimal Sensor Definitions
#  Only sensors actually used for calculations and inputs
#  Controls (temperature setpoints, mode selection) are now MQTT-based
#

#########################################
#   SENSORS                             
#########################################
sensor:
  # Required for COP calculations
  - platform: template
    name: "EL_AUFNAHMELEISTUNG_HEIZ_SUM"
    id: EL_AUFNAHMELEISTUNG_HEIZ_SUM
    internal: true
    unit_of_measurement: MWh
    device_class: energy
    accuracy_decimals: 3
    state_class: "total_increasing"

  - platform: template
    name: "EL_AUFNAHMELEISTUNG_WW_SUM"
    id: EL_AUFNAHMELEISTUNG_WW_SUM
    internal: true
    unit_of_measurement: MWh
    device_class: energy
    accuracy_decimals: 3
    state_class: "total_increasing"

  - platform: template
    name: "WAERMEERTRAG_2WE_HEIZ_SUM"
    id: WAERMEERTRAG_2WE_HEIZ_SUM
    internal: true
    unit_of_measurement: MWh
    device_class: energy
    accuracy_decimals: 3
    state_class: "total_increasing"

  - platform: template
    name: "WAERMEERTRAG_2WE_WW_SUM"
    id: WAERMEERTRAG_2WE_WW_SUM
    internal: true
    unit_of_measurement: MWh
    device_class: energy
    accuracy_decimals: 3
    state_class: "total_increasing"

  - platform: template
    name: "WAERMEERTRAG_HEIZ_SUM"
    id: WAERMEERTRAG_HEIZ_SUM
    internal: true
    unit_of_measurement: MWh
    device_class: energy
    accuracy_decimals: 3
    state_class: "total_increasing"

  - platform: template
    name: "WAERMEERTRAG_WW_SUM"
    id: WAERMEERTRAG_WW_SUM
    internal: true
    unit_of_measurement: MWh
    device_class: energy
    accuracy_decimals: 3
    state_class: "total_increasing"

  # Date/time sensors - values tracked internally in C++ code
  # No template sensors needed - values stored in static variables

  # Required for Home Assistant input helpers
  - platform: template
    name: "EINSTELL_SPEICHERSOLLTEMP"
    id: EINSTELL_SPEICHERSOLLTEMP
    internal: true
    unit_of_measurement: "째C"
    accuracy_decimals: 1

  - platform: template
    name: "EINSTELL_SPEICHERSOLLTEMP2"
    id: EINSTELL_SPEICHERSOLLTEMP2
    internal: true
    unit_of_measurement: "째C"
    accuracy_decimals: 1

  - platform: template
    name: "SPEICHERISTTEMP"
    id: SPEICHERISTTEMP
    internal: true
    unit_of_measurement: "째C"
    accuracy_decimals: 1
    filters:
      - offset: 3.9

  - platform: template
    name: "SPEICHERSOLLTEMP"
    id: SPEICHERSOLLTEMP
    internal: true
    unit_of_measurement: "째C"
    accuracy_decimals: 1

  # COP output sensors
  - platform: template
    name: "COP_WW"
    id: COP_WW
    internal: true
    device_class: "power_factor"
    accuracy_decimals: 2

  - platform: template
    name: "COP_HEIZ"
    id: COP_HEIZ
    internal: true
    device_class: "power_factor"
    accuracy_decimals: 2

  - platform: template
    name: "COP_GESAMT"
    id: COP_GESAMT
    internal: true
    device_class: "power_factor"
    accuracy_decimals: 2

#########################################
#   TEXT SENSOREN                       
#########################################
text_sensor:
  # Text sensors with lambdas (used to trigger CAN reads)
  - platform: template
    name: "PROGRAMMSCHALTER"
    id: PROGRAMMSCHALTER
    internal: true
    lambda: |-
      readSignal(&CanMembers[cm_manager], "PROGRAMMSCHALTER");
      return {};

  - platform: template
    name: "SOMMERBETRIEB"
    id: SOMMERBETRIEB
    internal: true
    lambda: |-
      readSignal(&CanMembers[cm_manager], "SOMMERBETRIEB");
      return {};

  - platform: template
    name: "WW_ECO"
    id: WW_ECO
    internal: true
    lambda: |-
      readSignal(&CanMembers[cm_manager], "WW_ECO");
      return {};
